extends ../../layouts/default.pug

block main
  .container.mt-4
    .d-flex.justify-content-between.align-items-center.mb-4
      h2.mb-0 Chi tiết sản phẩm
      button.btn.btn-dark#btn-edit(valueCurrent="readonly")
        i.fas.fa-sync-alt.me-1
        | Cập nhật

    form(method="POST", action=`${prefixAdmin}/products/edit`, enctype="multipart/form-data" form-edit)
      .row
        .col-md-6.mb-3
          label.form-label(for="title") Tên sản phẩm
          input.form-control(type="text", name="title", id="title", required, value=product.title || '')

        .col-md-6.mb-3
          label.form-label(for="price") Giá (VNĐ)
          input.form-control(type="number", name="price", id="price", required, value=product.price || '')

        .col-md-6.mb-3
          label.form-label(for="category") Danh mục
          select.form-select(name="categoryId", id="category", required)
            option(value="") -- Chọn danh mục --
            each category in categories
              option(value=category.id, selected=category.id == product.categoryId)= category.title

        .col-md-6.mb-3
          label.form-label(for="discount") Giảm giá (%)
          input.form-control(type="number", name="discount", id="discount", min="0", max="100", value=product.discount || 0)

        .col-md-6.mb-3
          label.form-label(for="stock") Số lượng
          input.form-control(type="number", name="stock", id="stock", min="0", value=product.stock || 0)

        .col-md-6.mb-3
          label.form-label(for="featured") Sản phẩm nổi bật?
          select.form-select(name="featured", id="featured", required)
            option(value="false", selected=product.featured === 0 || product.featured === 'false') -- Không --
            option(value="true", selected=product.featured === 1 || product.featured === 'true') -- Có --

      .mb-3
        label.form-label Ảnh sản phẩm

        ul.nav.nav-tabs(role="tablist")
          li.nav-item
            button.nav-link.active(type="button", data-bs-toggle="tab", data-bs-target="#tabUrl") Nhập URL
          li.nav-item
            button.nav-link(type="button", data-bs-toggle="tab", data-bs-target="#tabUpload") Upload từ máy

        .tab-content.border.rounded.p-3.mt-2
          .tab-pane.fade.show.active#tabUrl
            textarea.form-control(name="imageUrls", rows="6", placeholder="Mỗi dòng là 1 URL...", oninput="previewImageUrls(this.value)")
              = product.images && Array.isArray(product.images) ? product.images.join('\n') : ''
            .d-flex.flex-wrap.mt-2#urlPreview
              if product.images && Array.isArray(product.images)
                each url in product.images
                  img(src=url, style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px; margin: 4px")

          .tab-pane.fade#tabUpload
            input.form-control(type="file", name="imagesFiles", accept="image/*", multiple, onchange="previewImages(event)")
            .d-flex.flex-wrap.mt-2#uploadPreview

      .mb-3
        label.form-label(for="description") Mô tả
        textarea.form-control.tiny-mce(name="description", id="description", rows="5")= product.description || ''

      button.btn.btn-dark#btn-submit-edit(type="submit")
        i.fas.fa-plus.me-1
        | Cập nhật sản phẩm

      a.btn.btn-secondary.ms-2(href=`${prefixAdmin}/products`) Hủy